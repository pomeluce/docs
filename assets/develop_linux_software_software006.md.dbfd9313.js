import{_ as s,o as a,c as n,V as l}from"./chunks/framework.a215caf7.js";const o="/docs/assets/image-20231129222617708.aa360dad.png",p="/docs/assets/image-20231129223115890.8383e0ee.png",e="/docs/assets/image-20231129223403474.ce1793c5.png",t="/docs/assets/image-20231129223633796.a82ff012.png",r="/docs/assets/image-20231129223804767.bb427a8e.png",c="/docs/assets/image-20231129224651447.e04e70da.png",F=JSON.parse('{"title":"Grafana 监控","description":"","frontmatter":{},"headers":[],"relativePath":"develop/linux/software/software006.md","filePath":"develop/linux/software/software006.md","lastUpdated":1701271871000}'),i={name:"develop/linux/software/software006.md"},B=l(`<h1 id="grafana-监控" tabindex="-1">Grafana 监控 <a class="header-anchor" href="#grafana-监控" aria-label="Permalink to &quot;Grafana 监控&quot;">​</a></h1><h2 id="软件安装" tabindex="-1">软件安装 <a class="header-anchor" href="#软件安装" aria-label="Permalink to &quot;软件安装&quot;">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># Arch Linux</span></span>
<span class="line"><span style="color:#61AFEF;">pacman/yay</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-S</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">grafana</span></span></code></pre></div><h2 id="软件配置" tabindex="-1">软件配置 <a class="header-anchor" href="#软件配置" aria-label="Permalink to &quot;软件配置&quot;">​</a></h2><h3 id="面板访问" tabindex="-1">面板访问 <a class="header-anchor" href="#面板访问" aria-label="Permalink to &quot;面板访问&quot;">​</a></h3><ol><li>软件安装完成后, 即可访问面板, 地址为: <code>http://ip:3000</code></li><li>默认用户名和密码为 admin, 登录后会要求重新设置密码, 然后进入到主页面</li></ol><p><img src="`+o+'" alt="grafan-主界面"></p><ol start="3"><li>点击右上角个头像, 点击 profile(个人资料), 找到 language 选项, 选择中文, 点击 save 保存</li><li>回到首页, 点击左上角, 添加数据源, 用于监控面板的数据来源</li></ol><p><img src="'+p+'" alt="添加数据源"></p><ol start="5"><li>在数据源添加面板搜索 prometheus, 添加 prometheus 的 Data source 数据源</li></ol><p><img src="'+e+'" alt="添加prometheus"></p><ol start="6"><li>点击 右上角 add new data source</li></ol><p><img src="'+t+'" alt="add-new-data_source"></p><ol start="7"><li>填写 prometheus 链接地址, 填写完成后, 点击 save &amp; test 按钮</li></ol><p><img src="'+r+'" alt="填写链接地址"></p><ol start="8"><li>点击菜单栏 -&gt; 仪表盘, 选择新建 -&gt; 新建仪表盘, 即可创建面板</li><li>点击添加可视化 -&gt; 选择刚刚添加的 prometheus 数据源, 进入面部选择 <code>指标 + 标签组</code>, 点击右上角刷新按钮, 点击 apply 保存</li></ol><p><img src="'+c+`" alt="新建面板"></p><ol start="10"><li>自己新建面板太过麻烦, 可以在官方的<a href="https://grafana.com/grafana/dashboards/" target="_blank" rel="noreferrer">模板网站</a>根据要监控的服务选择何时的模板, 然后直接导入</li><li>导入方式有三种: 导入模板 json 文件、通过 id 导入、复制 json 文本导入, 如果可以连接外网的话可以直接复制 id 导入, 很方便</li></ol><h3 id="域名访问" tabindex="-1">域名访问 <a class="header-anchor" href="#域名访问" aria-label="Permalink to &quot;域名访问&quot;">​</a></h3><ol><li>修改 grafana 配置文件, <code>/etc/grafana.ini</code></li><li>设置 domain 为你的访问域名, root_url 为访问路径, serve_from_sub_path 设置为 true</li></ol><div class="language-ini"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">domain</span><span style="color:#98C379;"> </span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;"> www.xxx.com</span></span>
<span class="line"><span style="color:#C678DD;">root_url</span><span style="color:#98C379;"> </span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;"> %(protocol)s://%(domain)s:%(http_port)s/</span></span>
<span class="line"><span style="color:#C678DD;">serve_from_sub_path</span><span style="color:#98C379;"> </span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;"> tru</span></span></code></pre></div><ol start="3"><li>如果要开启 https 访问的话, 还需开启 https 配置和 ssl 证书</li></ol><div class="language-ini"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">protocol</span><span style="color:#98C379;"> </span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;"> https</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">; https certs &amp; key file</span></span>
<span class="line"><span style="color:#C678DD;">cert_file</span><span style="color:#98C379;"> </span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;"> /ssl/path/ssl_server.pem</span></span>
<span class="line"><span style="color:#C678DD;">cert_key</span><span style="color:#98C379;"> </span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;"> /ssl/path/ssl_private.key</span></span></code></pre></div><ol start="4"><li>nginx 设置请求转发</li></ol><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">server</span><span style="color:#ABB2BF;"> {    </span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># listen       80;</span></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#C678DD;"> listen </span><span style="color:#ABB2BF;">      </span><span style="color:#D19A66;">443</span><span style="color:#ABB2BF;"> ssl;   </span></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#C678DD;"> server_name </span><span style="color:#ABB2BF;"> www.xxx.org;                                                                                                                            </span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">location</span><span style="color:#ABB2BF;"> / {   </span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#C678DD;"> root </span><span style="color:#ABB2BF;">   html;</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#C678DD;"> index </span><span style="color:#ABB2BF;">  index.html index.htm; </span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#C678DD;"> proxy_pass </span><span style="color:#ABB2BF;">https://localhost:3000; </span><span style="color:#7F848E;font-style:italic;"># grafana 访问地址 </span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#C678DD;"> proxy_set_header </span><span style="color:#ABB2BF;">Host $</span><span style="color:#E06C75;">http_host</span><span style="color:#ABB2BF;">; </span><span style="color:#7F848E;font-style:italic;"># 设置请求头 host, 防止 api/ds/query 获取数据 not-allowed</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#C678DD;"> proxy_redirect </span><span style="color:#ABB2BF;">default;    </span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#C678DD;"> proxy_max_temp_file_size </span><span style="color:#ABB2BF;">0k;</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#C678DD;"> proxy_connect_timeout </span><span style="color:#ABB2BF;">30;</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#C678DD;"> proxy_send_timeout </span><span style="color:#ABB2BF;">60; </span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#C678DD;"> proxy_read_timeout </span><span style="color:#ABB2BF;">60; </span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#C678DD;"> proxy_next_upstream </span><span style="color:#ABB2BF;">error timeout invalid_header http_502;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }  </span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre></div>`,25),y=[B];function d(_,h,m,u,g,f){return a(),n("div",null,y)}const D=s(i,[["render",d]]);export{F as __pageData,D as default};
