import{_ as s,o as n,c as a,V as l}from"./chunks/framework.a215caf7.js";const x=JSON.parse('{"title":"Nginx 安装配置","description":"","frontmatter":{},"headers":[],"relativePath":"develop/linux/software/software005.md","filePath":"develop/linux/software/software005.md","lastUpdated":1701177623000}'),p={name:"develop/linux/software/software005.md"},o=l(`<h1 id="nginx-安装配置" tabindex="-1">Nginx 安装配置 <a class="header-anchor" href="#nginx-安装配置" aria-label="Permalink to &quot;Nginx 安装配置&quot;">​</a></h1><h2 id="nginx安装" tabindex="-1">Nginx安装 <a class="header-anchor" href="#nginx安装" aria-label="Permalink to &quot;Nginx安装&quot;">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># Arch Linux</span></span>
<span class="line"><span style="color:#61AFEF;">pacman/yay</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-S</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">nginx</span></span></code></pre></div><h2 id="nginx配置" tabindex="-1">Nginx配置 <a class="header-anchor" href="#nginx配置" aria-label="Permalink to &quot;Nginx配置&quot;">​</a></h2><h3 id="二级域名配置" tabindex="-1">二级域名配置 <a class="header-anchor" href="#二级域名配置" aria-label="Permalink to &quot;二级域名配置&quot;">​</a></h3><ol><li>配置文件添加二级域名 server 配置</li></ol><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">http</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">server</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#C678DD;"> listen </span><span style="color:#ABB2BF;">      </span><span style="color:#D19A66;">80</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#C678DD;"> server_name </span><span style="color:#ABB2BF;"> xxx.com; </span><span style="color:#7F848E;font-style:italic;"># 主域名</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">location</span><span style="color:#ABB2BF;"> / {</span></span>
<span class="line"><span style="color:#ABB2BF;">           </span><span style="color:#C678DD;"> root </span><span style="color:#ABB2BF;">  /usr/share/nginx/html;</span></span>
<span class="line"><span style="color:#ABB2BF;">           </span><span style="color:#C678DD;"> index </span><span style="color:#ABB2BF;"> index.html index.htm;</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">server</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#C678DD;"> listen </span><span style="color:#ABB2BF;">      </span><span style="color:#D19A66;">80</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#C678DD;"> server_name </span><span style="color:#ABB2BF;"> doc.xxx.com; </span><span style="color:#7F848E;font-style:italic;"># 二级域名</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">location</span><span style="color:#ABB2BF;"> / {</span></span>
<span class="line"><span style="color:#ABB2BF;">           </span><span style="color:#C678DD;"> root </span><span style="color:#ABB2BF;">  /xxx/xxx/xxx;</span></span>
<span class="line"><span style="color:#ABB2BF;">           </span><span style="color:#C678DD;"> index </span><span style="color:#ABB2BF;"> index.html index.htm;</span></span>
<span class="line"><span style="color:#ABB2BF;">           </span><span style="color:#C678DD;"> try_files </span><span style="color:#ABB2BF;">$</span><span style="color:#E06C75;">uri</span><span style="color:#ABB2BF;"> $</span><span style="color:#E06C75;">uri</span><span style="color:#ABB2BF;">/ /index.html; </span><span style="color:#7F848E;font-style:italic;"># 解决刷新 404</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 可配多个二级域名 server</span></span>
<span class="line"><span style="color:#ABB2BF;">    ...</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre></div><ol start="2"><li>域名 DNS 服务器使用 A 记录执行服务器 ip</li></ol><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#abb2bf;">|  Type  |   Host   |   Value   |    TTL    |</span></span>
<span class="line"><span style="color:#abb2bf;">---------------------------------------------</span></span>
<span class="line"><span style="color:#abb2bf;">|A Record|    doc   |xx.xx.xx.xx|   1 min   |</span></span></code></pre></div><ol start="3"><li>先停止 nginx 服务, 在启动, restart 可能会不生效</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">stop</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">nginx.service</span></span>
<span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">sart</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">nginx.service</span></span></code></pre></div><h3 id="https配置" tabindex="-1">Https配置 <a class="header-anchor" href="#https配置" aria-label="Permalink to &quot;Https配置&quot;">​</a></h3><ol><li>先获取 ssl 证书, 拿到 pem 证书和 key 私钥</li><li>开启 443 端口, 配置证书</li></ol><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">server</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># listen       80;</span></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#C678DD;"> listen </span><span style="color:#ABB2BF;">      </span><span style="color:#D19A66;">443</span><span style="color:#ABB2BF;"> ssl;</span></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#C678DD;"> server_name </span><span style="color:#ABB2BF;"> www.xxx.com;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#C678DD;"> ssl_certificate </span><span style="color:#ABB2BF;">     /pem/path/ssl_server.pem; </span><span style="color:#7F848E;font-style:italic;"># 证书</span></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#C678DD;"> ssl_certificate_key </span><span style="color:#ABB2BF;"> /key/path/ssl_private.key; </span><span style="color:#7F848E;font-style:italic;"># 私钥</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#C678DD;"> ssl_session_cache </span><span style="color:#ABB2BF;">   shared:SSL:1m;</span></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#C678DD;"> ssl_session_timeout </span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">5m</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#C678DD;"> ssl_ciphers </span><span style="color:#ABB2BF;">ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;    </span><span style="color:#7F848E;font-style:italic;">#加密算法</span></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#C678DD;"> ssl_prefer_server_ciphers </span><span style="color:#D19A66;"> on</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#C678DD;"> ssl_protocols </span><span style="color:#ABB2BF;">TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; </span><span style="color:#7F848E;font-style:italic;">#安全链接可选的加密协议</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">location</span><span style="color:#ABB2BF;"> / {</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#C678DD;"> root </span><span style="color:#ABB2BF;">  /usr/share/nginx/html;</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#C678DD;"> index </span><span style="color:#ABB2BF;"> index.html index.htm;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre></div><ol start="3"><li>重启 nginx 服务</li></ol><h3 id="_301重定向" tabindex="-1">301重定向 <a class="header-anchor" href="#_301重定向" aria-label="Permalink to &quot;301重定向&quot;">​</a></h3><ul><li>设置 xxx.com 根域名跳转 www.xxx.com, 方便网站 seo</li></ul><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">server</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># listen       80;</span></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#C678DD;"> listen </span><span style="color:#ABB2BF;">      </span><span style="color:#D19A66;">443</span><span style="color:#ABB2BF;"> ssl;</span></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#C678DD;"> server_name </span><span style="color:#ABB2BF;"> xxx.com www.xxx.com; </span><span style="color:#7F848E;font-style:italic;"># 匹配根域名和 www 域名</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 不是 www 域名, 则将根域名跳转到 www 域名</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> ($</span><span style="color:#E06C75;">host</span><span style="color:#ABB2BF;"> != </span><span style="color:#98C379;">&#39;www.xxx.com&#39;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">rewrite</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">^/(.*)$</span><span style="color:#ABB2BF;"> https://www.pomeluce.org/$</span><span style="color:#E06C75;">1</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">permanent</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">location</span><span style="color:#ABB2BF;"> / {</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#C678DD;"> root </span><span style="color:#ABB2BF;">  /usr/share/nginx/html;</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#C678DD;"> index </span><span style="color:#ABB2BF;"> index.html index.htm;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre></div>`,18),e=[o];function t(c,r,B,i,y,A){return n(),a("div",null,e)}const d=s(p,[["render",t]]);export{x as __pageData,d as default};
