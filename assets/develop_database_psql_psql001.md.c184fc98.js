import{_ as s,o as a,c as l,V as o}from"./chunks/framework.a215caf7.js";const u=JSON.parse('{"title":"PostgreSQL 安装","description":"","frontmatter":{},"headers":[],"relativePath":"develop/database/psql/psql001.md","filePath":"develop/database/psql/psql001.md","lastUpdated":1689440421000}'),n={name:"develop/database/psql/psql001.md"},p=o(`<h1 id="postgresql-安装" tabindex="-1">PostgreSQL 安装 <a class="header-anchor" href="#postgresql-安装" aria-label="Permalink to &quot;PostgreSQL 安装&quot;">​</a></h1><h2 id="_1-安装-postgresql" tabindex="-1">1. 安装 PostgreSQL <a class="header-anchor" href="#_1-安装-postgresql" aria-label="Permalink to &quot;1. 安装 PostgreSQL&quot;">​</a></h2><h3 id="_1-linux-安装" tabindex="-1">1. Linux 安装 <a class="header-anchor" href="#_1-linux-安装" aria-label="Permalink to &quot;1. Linux 安装&quot;">​</a></h3><ul><li>Arch Linux</li></ul><div class="language-zsh"><button title="Copy Code" class="copy"></button><span class="lang">zsh</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">yay/pacman</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-S</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">postgresql</span></span></code></pre></div><ul><li>Centos Linux</li></ul><div class="language-zsh"><button title="Copy Code" class="copy"></button><span class="lang">zsh</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">sudo</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">sh</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-c</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;echo &quot;deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main&quot; &gt; /etc/apt/sources.list.d/pgdg.list&#39;</span></span>
<span class="line"><span style="color:#61AFEF;">wget</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--quiet</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-O</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">-</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">https://www.postgresql.org/media/keys/ACCC4CF8.asc</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">sudo</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">apt-key</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">add</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">-</span></span>
<span class="line"><span style="color:#61AFEF;">sudo</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">apt-get</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">update</span></span>
<span class="line"><span style="color:#61AFEF;">sudo</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">apt-get</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-y</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">install</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">postgresql</span></span></code></pre></div><h3 id="_2-windows-安装" tabindex="-1">2. Windows 安装 <a class="header-anchor" href="#_2-windows-安装" aria-label="Permalink to &quot;2. Windows 安装&quot;">​</a></h3><p>在<a href="https://www.enterprisedb.com/downloads/postgres-postgresql-downloads" target="_blank" rel="noreferrer">下载页面</a>选择要安装的版本对应的 Windows 安装包, 一键安装</p><h2 id="_2-初始化数据库" tabindex="-1">2. 初始化数据库 <a class="header-anchor" href="#_2-初始化数据库" aria-label="Permalink to &quot;2. 初始化数据库&quot;">​</a></h2><h3 id="_1-设置用户密码" tabindex="-1">1. 设置用户密码 <a class="header-anchor" href="#_1-设置用户密码" aria-label="Permalink to &quot;1. 设置用户密码&quot;">​</a></h3><ul><li>Linux 系统在安装完成之后, 会默认创建一个系统用户 postgres, 密码为空, 需要设置一个密码</li></ul><div class="language-zsh"><button title="Copy Code" class="copy"></button><span class="lang">zsh</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">sudo</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">passwd</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">postgres</span></span></code></pre></div><h3 id="_2-初始化数据库-1" tabindex="-1">2. 初始化数据库 <a class="header-anchor" href="#_2-初始化数据库-1" aria-label="Permalink to &quot;2. 初始化数据库&quot;">​</a></h3><ul><li>使用 postgres 用户执行 initdb 命令初始化, 指定数据库的区域、字符进编码、以及数据目录</li></ul><div class="language-zsh"><button title="Copy Code" class="copy"></button><span class="lang">zsh</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">sudo</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">su</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">-</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">postgres</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-c</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;initdb --locale en_US.UTF-8 -E UTF8 -D &#39;/var/lib/postgres/data&#39;&quot;</span></span></code></pre></div><h3 id="_3-启动数据库" tabindex="-1">3. 启动数据库 <a class="header-anchor" href="#_3-启动数据库" aria-label="Permalink to &quot;3. 启动数据库&quot;">​</a></h3><div class="language-zsh"><button title="Copy Code" class="copy"></button><span class="lang">zsh</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">enable</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--now</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">postgresql.service</span></span></code></pre></div><h2 id="_3-启用密码登录" tabindex="-1">3. 启用密码登录 <a class="header-anchor" href="#_3-启用密码登录" aria-label="Permalink to &quot;3. 启用密码登录&quot;">​</a></h2><p>PostgreSQL 安装完成之后, 默认登录是不验证密码的, 我们需要开启密码验证功能</p><h3 id="_1-修改用户密码" tabindex="-1">1. 修改用户密码 <a class="header-anchor" href="#_1-修改用户密码" aria-label="Permalink to &quot;1. 修改用户密码&quot;">​</a></h3><ul><li>首先, 进入到命令行交互界面</li></ul><div class="language-zsh"><button title="Copy Code" class="copy"></button><span class="lang">zsh</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">psql</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-U</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">postgres</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-d</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">postgres</span></span></code></pre></div><ul><li>执行 alter 语句修改用户密码</li></ul><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">alter</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">user</span><span style="color:#ABB2BF;"> postgres </span><span style="color:#C678DD;">with</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">password</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;密码&#39;</span></span></code></pre></div><h3 id="_2-开启密码登录" tabindex="-1">2. 开启密码登录 <a class="header-anchor" href="#_2-开启密码登录" aria-label="Permalink to &quot;2. 开启密码登录&quot;">​</a></h3><ul><li>使用 vim 编辑 pg_hba.conf 文件</li></ul><div class="language-zsh"><button title="Copy Code" class="copy"></button><span class="lang">zsh</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">sudo</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">vim</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/var/lib/postgres/data/pg_hba.conf</span></span></code></pre></div><ul><li>设置密码加密方式</li></ul><div class="language-zsh"><button title="Copy Code" class="copy"></button><span class="lang">zsh</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># TYPE  DATABASE        USER            ADDRESS                 METHOD</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 允许本地数据库连接, 并进行密码验证</span></span>
<span class="line"><span style="color:#C678DD;">local</span><span style="color:#ABB2BF;">   </span><span style="color:#98C379;">all</span><span style="color:#ABB2BF;">             </span><span style="color:#98C379;">all</span><span style="color:#ABB2BF;">                                     </span><span style="color:#98C379;">scram-sha-256</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 允许任何 ip 进行数据库连接, 并进行密码验证</span></span>
<span class="line"><span style="color:#61AFEF;">host</span><span style="color:#ABB2BF;">    </span><span style="color:#98C379;">all</span><span style="color:#ABB2BF;">             </span><span style="color:#98C379;">all</span><span style="color:#ABB2BF;">             </span><span style="color:#D19A66;">0.0</span><span style="color:#98C379;">.0.0/0</span><span style="color:#ABB2BF;">               </span><span style="color:#98C379;">scram-sha-256</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">加密方式:</p><blockquote><p>可以是<code>trust</code>、<code>reject</code>、<code>md5</code>、<code>password</code>、<code>scram-sha-256</code>、<code>gss</code>、<code>sspi</code>、<code>ident</code>、<code>peer</code>、<code>pam</code>、<code>ldap</code>、<code>radius</code> 或 <code>cert</code> 请注意, <code>password</code> 以明文形式发送密码; <code>md5</code> 或 <code>scram-sha-256</code> 是首选, 因为它们发送加密的密码</p></blockquote></div><ul><li>重启 postgres 服务</li></ul><div class="language-zsh"><button title="Copy Code" class="copy"></button><span class="lang">zsh</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">restart</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">postgresql.service</span></span></code></pre></div><h2 id="_4-用户配置-可选" tabindex="-1">4. 用户配置(可选) <a class="header-anchor" href="#_4-用户配置-可选" aria-label="Permalink to &quot;4. 用户配置(可选)&quot;">​</a></h2><p>在安装完之后可以创建一个与当前系统用户名同名的数据库用户, 并允许其访问 PostgreSQL 数据库的 shell, 那么在使用PostgreSQL 数据库 shell 的时候无需指定用户登录(这样做会比较方便)</p><ul><li>例如, 当前系统用户名为: psdb, 那么我们可以使用如下命令创建一个 psdb 的数据库用户</li></ul><div class="language-zsh"><button title="Copy Code" class="copy"></button><span class="lang">zsh</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 使用 postgres 用户执行用户创建命令</span></span>
<span class="line"><span style="color:#61AFEF;">sudo</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">su</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">-</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">postgres</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-c</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;createuser --interactive&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 或者进入到 postgres 用户, 然后执行命令</span></span>
<span class="line"><span style="color:#61AFEF;">su</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">postgres</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">createuser</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--interactive</span></span></code></pre></div><ul><li>执行完毕后会有如下输出, 提示你输入要创建的用户用户名, 是否分配为超级管理员</li></ul><div class="tip custom-block"><p class="custom-block-title">$ sudo su - postgres -c &quot;createuser --interactive&quot;</p><p>​ Enter name of role to add: psdb</p><p>​ Shall the new role be a superuser? (y/n) y</p></div><ul><li>回到系统 shell, 使用 createdb 命令创建一个同名数据库</li></ul><div class="language-zsh"><button title="Copy Code" class="copy"></button><span class="lang">zsh</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">createdb</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">psdb</span></span></code></pre></div><ul><li>创建完成后, 就可以在当前系统用户下, 直接使用 psql 启动进入当前 PostgreSQL 命令行交互界面</li></ul><div class="language-zsh"><button title="Copy Code" class="copy"></button><span class="lang">zsh</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">psql</span></span></code></pre></div><ul><li>可以使用如下命令进行信息查看 <ul><li><code>\\du</code>: 命令列出所有用户和权限</li><li><code>\\dt</code>: 命令展示当前数据库所有表相关的汇总字段</li><li><code>\\help</code>: 查看帮助</li><li><code>\\q</code>: 退出命令行</li></ul></li></ul><div class="language-zsh"><button title="Copy Code" class="copy"></button><span class="lang">zsh</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">➜</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">psql</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-U</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">root</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-d</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">lucasdb</span></span>
<span class="line"><span style="color:#61AFEF;">psql</span><span style="color:#ABB2BF;"> (15.3)</span></span>
<span class="line"><span style="color:#61AFEF;">输入</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;help&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">来获取帮助信息.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">lucasdb</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">#</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">\\du</span></span>
<span class="line"><span style="color:#ABB2BF;">                             </span><span style="color:#61AFEF;">角色列表</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#61AFEF;">角色名称</span><span style="color:#ABB2BF;"> |                    </span><span style="color:#61AFEF;">属性</span><span style="color:#ABB2BF;">                     | </span><span style="color:#61AFEF;">成员属于</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#61AFEF;">----------+--------------------------------------------+----------</span></span>
<span class="line"><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">postgres</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">超级用户,</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">建立角色,</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">建立</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">DB,</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">复制,</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">绕过RLS</span><span style="color:#ABB2BF;">      | {}</span></span>
<span class="line"><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">root</span><span style="color:#ABB2BF;">     | </span><span style="color:#61AFEF;">超级用户,</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">建立角色,</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">建立</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">DB</span><span style="color:#ABB2BF;">                   | {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">lucasdb</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">#</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">\\dt</span></span>
<span class="line"><span style="color:#61AFEF;">没有找到任何关系.</span></span>
<span class="line"><span style="color:#E06C75;">lucasdb</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">#</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">\\q</span></span></code></pre></div>`,45),e=[p];function t(c,r,i,B,y,d){return a(),l("div",null,e)}const A=s(n,[["render",t]]);export{u as __pageData,A as default};
