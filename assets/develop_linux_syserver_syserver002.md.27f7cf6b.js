import{_ as s,o as l,c as a,V as n}from"./chunks/framework.a215caf7.js";const A=JSON.parse('{"title":"VPS 安装 Arch Linux","description":"","frontmatter":{},"headers":[],"relativePath":"develop/linux/syserver/syserver002.md","filePath":"develop/linux/syserver/syserver002.md","lastUpdated":1700918166000}'),o={name:"develop/linux/syserver/syserver002.md"},p=n(`<h1 id="vps-安装-arch-linux" tabindex="-1">VPS 安装 Arch Linux <a class="header-anchor" href="#vps-安装-arch-linux" aria-label="Permalink to &quot;VPS 安装 Arch Linux&quot;">​</a></h1><p><strong>适用条件</strong></p><ol><li><p>没有远程控制台(VNC/IPMI) 且不能挂载 ISO 的服务器</p></li><li><p>从头安装, 定制更多内容(如硬盘重新分区后安装)</p></li><li><p>服务器具有足够的内存, 2G 起步</p></li></ol><h2 id="grml安装" tabindex="-1">Grml安装 <a class="header-anchor" href="#grml安装" aria-label="Permalink to &quot;Grml安装&quot;">​</a></h2><p>Grml 是一个基于 Debian 的可引导实时系统(Live-CD), Grml 内置很多适用于系统管理员的 GNU/Linux 软件, Grml 特别适用于安装、部署和系统救援等管理任务,而 grml-rescueboot 可以帮你轻松完成 GRUB 引导 ISO 的配置, 方便随时引导 Grml Live Linux.</p><ol><li>服务器需要先安装 Debian 系统, 在自己的服务器云控制台选择 Debian11 安装</li><li>安装 grml-rescueboot</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">apt</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-y</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">update</span></span>
<span class="line"><span style="color:#61AFEF;">apt</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-y</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">install</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">grml-rescueboot</span></span></code></pre></div><ol start="3"><li>下载 grml 的 iso 镜像</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 可以使用如下命令自动下载最新的 grml iso, 但是这个只能下载 full 版本的 iso</span></span>
<span class="line"><span style="color:#61AFEF;">update-grml-rescueboot</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 如果机器内存较小, 我们可以手动下载并使用 small 版本的 iso</span></span>
<span class="line"><span style="color:#56B6C2;">cd</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/boot/grml</span></span>
<span class="line"><span style="color:#61AFEF;">wget</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">https://download.grml.org/grml64-small_2022.11.iso</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">注:</p><ul><li><p>即便是 small 版本的 iso, 如果启动参数有 toram(将整个系统放在内存运行)机器内存也至少需要 2gb 才能引导;</p></li><li><p>对于大多数使用情况而言, toram 是一个必须要启用的配置, 如果仅仅只是通过硬盘引导 iso 的话, 可以做的事情非常有限, 比如你要给硬盘重新分区就无法完成</p></li></ul></div><ol start="4"><li>编辑配置文件, 在这个配置文件里面我们需要配置 ssh 密码等一些信息</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">vim</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/etc/default/grml-rescueboot</span></span></code></pre></div><ol start="5"><li>对于原系统是 debian 的, 并且使用 ifupdown 来管理网络的机器, 可以在启动选项里面使用 debnet, 这样 grml 就会自动将原系统内的 interfaces 配置文件复制到 grml 内使用</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E06C75;">CUSTOM_BOOTOPTIONS</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;ssh=password lang=us keyboard=us tz=Asia/Shanghai debnet toram&quot;</span></span></code></pre></div><ol start="6"><li>如果原系统的网关 ip 不在同一网段, grml 将无法添加默认路由, 在启动选项里面加入 services=networking 即可解决</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E06C75;">CUSTOM_BOOTOPTIONS</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;ssh=password lang=us keyboard=us tz=Asia/Shanghai services=networking debnet toram&quot;</span></span></code></pre></div><ol start="7"><li>如果原系统不是 debian, 但只要网络支持 dhcp, 你还可以使用下面的配置</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E06C75;">CUSTOM_BOOTOPTIONS</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;ssh=password lang=us keyboard=us tz=Asia/Shanghai toram&quot;</span></span></code></pre></div><blockquote><p>还可以配置使用静态地址, 有需要的可以看看官方的<a href="http://grml.org/cheatcodes/" target="_blank" rel="noreferrer">文档</a></p></blockquote><ol start="8"><li>更新 grub 配置</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">update-grub</span></span></code></pre></div><ol start="9"><li>让机器下一次启动的时候引导 grml</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 使用 full iso 的使用如下命令</span></span>
<span class="line"><span style="color:#61AFEF;">grub-reboot</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;Grml Rescue System (grml64-full_2022.11.iso)&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用 small iso 的使用如下命令</span></span>
<span class="line"><span style="color:#61AFEF;">grub-reboot</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;Grml Rescue System (grml64-small_2022.11.iso)&quot;</span></span></code></pre></div><ol start="10"><li>重启服务器</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">shutdown</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-r</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">now</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">PS:</p><ol><li><p>如果因为某种原因在重启后无法登录到 ssh, 只需在你的 VPS/服务器 面板重启一下即可恢复到之前的系统</p></li><li><p>重启进入系统后, 如果网络服务启动失败, 有如下提示信息: ifup waiting for lock on /run/network/ifstate.eth0</p><ul><li>执行 rm -rf /run/network/ifstate.eth0 先删除对应文件</li><li>再执行 systemctl stop networking, systemctl start networking</li><li>执行成功后, 修改 /etc/resolv.conf 文件, 添加 nameserver 114.114.114.114</li></ul></li><li><p>现在网络修复完成, 可以使用 ssh 远程进行连接</p></li></ol></div><h2 id="arch安装" tabindex="-1">Arch安装 <a class="header-anchor" href="#arch安装" aria-label="Permalink to &quot;Arch安装&quot;">​</a></h2><ol><li>下面的所有操作步骤都是在 Grml live 系统里面完成, 确保上述的配置完成, 首先下载 archlinux-bootstrap 并解压</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#56B6C2;">cd</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/tmp</span></span>
<span class="line"><span style="color:#61AFEF;">wget</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">https://geo.mirror.pkgbuild.com/iso/latest/archlinux-bootstrap-x86_64.tar.gz</span></span></code></pre></div><ol start="2"><li>由于整个 grml live 系统运行在内存里, 解压完成后务必删掉压缩包, 保证内存空间充足</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">tar</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-zxvf</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">archlinux-bootstrap-x86_64.tar.gz</span></span>
<span class="line"><span style="color:#61AFEF;">rm</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-rf</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">archlinux-bootstrap-x86_64.tar.gz</span></span></code></pre></div><ol start="3"><li>源配置文件</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">vim</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/tmp/root.x86_64/etc/pacman.d/mirrorlist</span></span></code></pre></div><ol start="4"><li>选择一个合适的镜像源, 取消注释</li></ol><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 这里我选择德国的一个镜像源</span></span>
<span class="line"><span style="color:#61AFEF;">Server</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">https://mirror.metalgamer.eu/archlinux/</span><span style="color:#E06C75;">$repo</span><span style="color:#98C379;">/os/</span><span style="color:#E06C75;">$arch</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 下面是一些镜像源选择</span></span>
<span class="line"><span style="color:#61AFEF;">Server</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">https://mirrors.ustc.edu.cn/archlinux/</span><span style="color:#E06C75;">$repo</span><span style="color:#98C379;">/os/</span><span style="color:#E06C75;">$arch</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 中科大</span></span>
<span class="line"><span style="color:#61AFEF;">Server</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">https://mirrors.tuna.tsinghua.edu.cn/archlinux/</span><span style="color:#E06C75;">$repo</span><span style="color:#98C379;">/os/</span><span style="color:#E06C75;">$arch</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 清华</span></span>
<span class="line"><span style="color:#61AFEF;">Server</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">https://mirror.archlinux.tw/ArchLinux/</span><span style="color:#E06C75;">$repo</span><span style="color:#98C379;">/os/</span><span style="color:#E06C75;">$arch</span><span style="color:#ABB2BF;">   </span><span style="color:#7F848E;font-style:italic;"># 东亚地区: 中华民国</span></span>
<span class="line"><span style="color:#61AFEF;">Server</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">https://mirror.0xem.ma/arch/</span><span style="color:#E06C75;">$repo</span><span style="color:#98C379;">/os/</span><span style="color:#E06C75;">$arch</span><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 北美洲地区: 加拿大</span></span>
<span class="line"><span style="color:#61AFEF;">Server</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">https://mirror.aktkn.sg/archlinux/</span><span style="color:#E06C75;">$repo</span><span style="color:#98C379;">/os/</span><span style="color:#E06C75;">$arch</span><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 东南亚地区: 新加坡</span></span>
<span class="line"><span style="color:#61AFEF;">Server</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">https://archlinux.uk.mirror.allworldit.com/archlinux/</span><span style="color:#E06C75;">$repo</span><span style="color:#98C379;">/os/</span><span style="color:#E06C75;">$arch</span><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 欧洲地区: 英国</span></span>
<span class="line"><span style="color:#61AFEF;">Server</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">https://mirrors.cat.net/archlinux/</span><span style="color:#E06C75;">$repo</span><span style="color:#98C379;">/os/</span><span style="color:#E06C75;">$arch</span><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 东亚地区: 日本</span></span></code></pre></div><ol start="5"><li>避免 chroot 后提示硬盘空间不足</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">mount</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--bind</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">root.x86_64</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">root.x86_64</span></span></code></pre></div><ol start="6"><li>chroot</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">/tmp/root.x86_64/bin/arch-chroot</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/tmp/root.x86_64/</span></span></code></pre></div><ol start="7"><li>初始化 key</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">pacman-key</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--init</span></span>
<span class="line"><span style="color:#61AFEF;">pacman-key</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--populate</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">archlinux</span></span></code></pre></div><ol start="8"><li>更新系统并安装分区需要用到的工具</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">pacman</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-Syyu</span></span>
<span class="line"><span style="color:#61AFEF;">pacman</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-S</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">dosfstools</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">parted</span></span></code></pre></div><ol start="9"><li>分区</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 首先将磁盘转换为 gpt 类型, 这里假设比如你想安装的磁盘名称为 vda, 如果你使用 NVME 的固态硬盘, 你看到的磁盘名称可能为 nvme0n1</span></span>
<span class="line"><span style="color:#61AFEF;">lsblk</span><span style="color:#ABB2BF;">                       </span><span style="color:#7F848E;font-style:italic;"># 显示分区情况 找到你想安装的磁盘名称</span></span>
<span class="line"><span style="color:#61AFEF;">parted</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/dev/vda</span><span style="color:#ABB2BF;">             </span><span style="color:#7F848E;font-style:italic;"># 执行 parted, 进入交互式命令行，进行磁盘类型变更</span></span>
<span class="line"><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">parted</span><span style="color:#ABB2BF;">)mktable             </span><span style="color:#7F848E;font-style:italic;"># 输入 mktable</span></span>
<span class="line"><span style="color:#61AFEF;">New</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">disk</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">label</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">type?</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">gpt</span><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 输入 gpt 将磁盘类型转换为 gpt 如磁盘有数据会警告, 输入 yes 即可</span></span>
<span class="line"><span style="color:#61AFEF;">quit</span><span style="color:#ABB2BF;">                        </span><span style="color:#7F848E;font-style:italic;"># 最后 quit 退出 parted 命令行交互</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">cfdisk</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/dev/vda</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 来执行分区操作, 分配各个分区大小, 类型</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># bios 引导需要分 BIOS boot, Linux Swap, Linux filesystem</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># uefi 引导需要分 EFI System, Linux Swap, Linux filesystem</span></span>
<span class="line"><span style="color:#61AFEF;">fdisk</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-l</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 分区结束后, 复查磁盘情况</span></span></code></pre></div><ol start="10"><li>格式化</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">mkfs.ext4</span><span style="color:#ABB2BF;">  </span><span style="color:#98C379;">/dev/vda3</span><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;"># 格式化根目录</span></span>
<span class="line"><span style="color:#61AFEF;">mkfs.vfat</span><span style="color:#ABB2BF;">  </span><span style="color:#98C379;">/dev/vda1</span><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;"># 格式化 efi 分区, 仅 uefi 引导需要</span></span>
<span class="line"><span style="color:#61AFEF;">mkswap</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/dev/vda2</span><span style="color:#ABB2BF;">				</span><span style="color:#7F848E;font-style:italic;"># 初始化 swap 分区</span></span>
<span class="line"><span style="color:#61AFEF;">mount</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/dev/vda3</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/mnt</span><span style="color:#ABB2BF;">			</span><span style="color:#7F848E;font-style:italic;"># 挂载分区</span></span>
<span class="line"><span style="color:#61AFEF;">swapon</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/dev/vda2</span><span style="color:#ABB2BF;">				</span><span style="color:#7F848E;font-style:italic;"># 启用 swap</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 仅 uefi 分区需要</span></span>
<span class="line"><span style="color:#61AFEF;">mount</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--mkdir</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/dev/vda1</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/mnt/efi</span></span></code></pre></div><ol start="11"><li>安装基本软件包</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">pacstrap</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/mnt</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">base</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">base-devel</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">linux</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">linux-headers</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">linux-firmware</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">dhcpcd</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">iwd</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">vim</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">bash-completion</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">grub</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">openssh</span></span></code></pre></div><ol start="12"><li>生成 fstab 配置文件</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">genfstab</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-U</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/mnt</span><span style="color:#ABB2BF;"> &gt;&gt; </span><span style="color:#98C379;">/mnt/etc/fstab</span></span></code></pre></div><ol start="13"><li>执行 <code>exit</code> 退出 chroot 环境</li><li>重新进入</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">/tmp/root.x86_64/bin/arch-chroot</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/tmp/root.x86_64/mnt</span></span></code></pre></div><ol start="15"><li>时区配置</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">ln</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-sf</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/usr/share/zoneinfo/Asia/Shanghai</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/etc/localtime</span></span>
<span class="line"><span style="color:#61AFEF;">hwclock</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--systohc</span></span>
<span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">enable</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">systemd-timesyncd.service</span></span></code></pre></div><ol start="16"><li>配置语言环境, 放开 en_US.UTF-8 所在行以及 zh_CN.UTF-8 所在行的注释符号</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">vim</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/etc/locale.gen</span></span></code></pre></div><ol start="17"><li>用如下命令生成 locale</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">locale-gen</span></span></code></pre></div><ol start="18"><li>向 /etc/locale.conf 导入内容</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#56B6C2;">echo</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;LANG=en_US.UTF-8&#39;</span><span style="color:#ABB2BF;">  &gt; </span><span style="color:#98C379;">/etc/locale.conf</span></span></code></pre></div><ol start="19"><li>设置主机名</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 加入你想为主机取的主机名, 例如: ArchLinux</span></span>
<span class="line"><span style="color:#61AFEF;">vim</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/etc/hostname</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 同时在 /etc/hosts 设置与其匹配的条目</span></span>
<span class="line"><span style="color:#61AFEF;">vim</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/etc/hosts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 加入如下内容</span></span>
<span class="line"><span style="color:#61AFEF;">127.0.0.1</span><span style="color:#ABB2BF;">   </span><span style="color:#98C379;">localhost</span></span>
<span class="line"><span style="color:#56B6C2;">:</span><span style="color:#ABB2BF;">:1         </span><span style="color:#98C379;">localhost</span></span>
<span class="line"><span style="color:#61AFEF;">127.0.1.1</span><span style="color:#ABB2BF;">   </span><span style="color:#98C379;">ArchLinux</span></span></code></pre></div><ol start="20"><li>设置网络, ip 地址可使用 <code>ip addr</code> 列出当前 ip 信息作参考</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">vim</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/etc/systemd/network/20-wired.network</span></span></code></pre></div><p>配置如下:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">[Match]</span></span>
<span class="line"><span style="color:#E06C75;">Name</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">eth0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">[Network]</span></span>
<span class="line"><span style="color:#E06C75;">Address</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">xx.xx.xx.xx/24</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># ipv4 地址</span></span>
<span class="line"><span style="color:#E06C75;">Address</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">xxx:xxx:xxx:xxx:xxx:xxx:xxx:xxx/80</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># ipv6 地址</span></span>
<span class="line"><span style="color:#E06C75;">IPv6AcceptRA</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">no</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">[Route]</span></span>
<span class="line"><span style="color:#E06C75;">Gateway</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">x.xx.xx.1</span></span>
<span class="line"><span style="color:#E06C75;">GatewayOnLink</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">yes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">[Route]</span></span>
<span class="line"><span style="color:#E06C75;">Gateway</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">xxx:xxx:xxx::1/80</span></span>
<span class="line"><span style="color:#E06C75;">GatewayOnLink</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">ye</span></span></code></pre></div><p>如果网络支持dhcp, systemd-networkd的 dhcp 配置可如下配置</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">[Match]</span></span>
<span class="line"><span style="color:#E06C75;">Name</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">eth0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">[Network]</span></span>
<span class="line"><span style="color:#E06C75;">DHCP</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">yes</span></span></code></pre></div><div class="info custom-block"><p class="custom-block-title">tip</p><p>更多关于systemd-networkd的内容可以参考：<a href="https://wiki.archlinuxcn.org/wiki/Systemd-networkd" target="_blank" rel="noreferrer">systemd-networkd</a></p></div><p>设置 systemd-networkd 开机自启</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">enable</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">systemd-networkd</span></span></code></pre></div><ol start="21"><li>配置 dns</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">nameserver</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">8.8</span><span style="color:#98C379;">.8.8</span></span>
<span class="line"><span style="color:#61AFEF;">nameserver</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">2001</span><span style="color:#98C379;">:4860:4860::8888</span></span>
<span class="line"><span style="color:#61AFEF;">nameserver</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">8.8</span><span style="color:#98C379;">.4.4</span></span>
<span class="line"><span style="color:#61AFEF;">nameserver</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">2001</span><span style="color:#98C379;">:4860:4860::8844</span></span></code></pre></div><ol start="22"><li>设置 root 用户名密码</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">passwd</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">root</span></span></code></pre></div><ol start="23"><li><p>设置 ssh 服务, 具体内容见: <a href="./../syserver/syserver001.html">ssh 免密配置</a></p></li><li><p>安装 grub</p></li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">pacman</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-S</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">grub</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 对于 bios 引导的机器请使用下面的命令, 注意是安装 grub 到硬盘而不是某一个分区</span></span>
<span class="line"><span style="color:#61AFEF;">grub-install</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--target=i386-pc</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/dev/vda</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 如果使用 uefi 引导, 则还需要安装 efibootmgr</span></span>
<span class="line"><span style="color:#61AFEF;">pacman</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-S</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">efibootmgr</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 然后使用下面的命令安装 grub</span></span>
<span class="line"><span style="color:#61AFEF;">grub-install</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--target=x86_64-efi</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--efi-directory=/efi</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--bootloader-id=GRUB</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 编辑配置文件, 去掉 GRUB_CMDLINE_LINUX_DEFAULT 参数的 quit</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 添加 net.ifnames=0(避免机器重启后, 网卡接口名无法与 systemd-networkd 内配置的接口名相匹配, 从而导致机器失联)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 添加 nowatchdog(提高开关机速度), 把 log level 的数值从 3 改成 5(出现系统错误方便排错)</span></span>
<span class="line"><span style="color:#61AFEF;">vim</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/etc/default/grub</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 生成 GRUB 所需的配置文件</span></span>
<span class="line"><span style="color:#61AFEF;">grub-mkconfig</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-o</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/boot/grub/grub.cfg</span></span></code></pre></div><ol start="25"><li>退出 chroot 环境并重启</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#56B6C2;">exit</span></span>
<span class="line"><span style="color:#61AFEF;">shutdown</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-r</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">now</span></span></code></pre></div>`,80),e=[p];function t(c,r,i,y,B,d){return l(),a("div",null,e)}const C=s(o,[["render",t]]);export{A as __pageData,C as default};
