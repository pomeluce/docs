import{_ as s,o as a,c as l,V as n}from"./chunks/framework.a215caf7.js";const F=JSON.parse('{"title":"ElasticSearch 相关","description":"","frontmatter":{},"headers":[],"relativePath":"develop/linux/software/software002.md","filePath":"develop/linux/software/software002.md","lastUpdated":1689440421000}'),e={name:"develop/linux/software/software002.md"},o=n(`<h1 id="elasticsearch-相关" tabindex="-1">ElasticSearch 相关 <a class="header-anchor" href="#elasticsearch-相关" aria-label="Permalink to &quot;ElasticSearch 相关&quot;">​</a></h1><h2 id="elastic无法连接及密码" tabindex="-1">Elastic无法连接及密码 <a class="header-anchor" href="#elastic无法连接及密码" aria-label="Permalink to &quot;Elastic无法连接及密码&quot;">​</a></h2><ol><li>ElasticSearch 无法连接原因: 修改 elasticsearch.yml 中的如下配置, 关闭 ssl 验证</li></ol><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># Enable encryption and mutual authentication between cluster nodes</span></span>
<span class="line"><span style="color:#E06C75;">xpack.security.http.ssl</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">enabled</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">false</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">keystore.path</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">certs/http.p12</span></span></code></pre></div><ol start="2"><li>关闭 ssl 验证后, 访问需要密码: 修改 elasticsearch.yml 中的如下配置, 关闭密码验证</li></ol><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># Enable security features</span></span>
<span class="line"><span style="color:#E06C75;">xpack.security.enabled</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">false</span></span></code></pre></div><h2 id="elastic操作相关错误" tabindex="-1">Elastic操作相关错误 <a class="header-anchor" href="#elastic操作相关错误" aria-label="Permalink to &quot;Elastic操作相关错误&quot;">​</a></h2><ol><li>ElasticSearch 无法获取数据: 使用 ElasticsearchRestTemplate 对象进行 search 操作时, 发送的请求 url 和端口不按配置文件走: <strong>注意在那个模块里使用的 restTemplate 对象调用方法, 就在对应的配置文件中配置地址和端口</strong></li></ol><div class="language-properties"><button title="Copy Code" class="copy"></button><span class="lang">properties</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">spring.elasticsearch.rest.uris</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">10.10.92.189:2900</span></span></code></pre></div><ol start="2"><li>Elasticsearch 操作报错 [reason=Fielddata is disabled on text fields by default]: 在分组统计时, 默认情况下 text 类型的 Fielddata 是被禁用的, 解决方式如下:</li></ol><ul><li>我们可以用 fieldname.keyword 进行聚合、排序, 代码修改为如下</li></ul><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E5C07B;">AggregationBuilders</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">terms</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;skuCategorygroup&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">field</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;category.keyword&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">size</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">50</span><span style="color:#ABB2BF;">)</span><span style="color:#E06C75;">)</span><span style="color:#ABB2BF;">;</span></span></code></pre></div><ul><li>设置字段的 fielddata=true, <em><s>不推荐, 这样可能会使用大量的内存</s></em></li></ul><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">PUT /索引名称/_mapping/doc</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">&quot;properties&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">&quot;category&quot;</span><span style="color:#ABB2BF;">: { </span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">&quot;type&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;text&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">&quot;fielddata&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre></div><ol start="3"><li>在使用 QueryBuilders 对象的设置查询条件时, <strong>需要注意如果查询的字段时 text 类型, 需要以 queryName.keyword 的形式设置查询条件</strong>, 否则可能无法查询处数据</li></ol><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E5C07B;">boolQueryBuilder</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">filter</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">QueryBuilders</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">termQuery</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;brand.keyword&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">searchMap</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;brand&quot;</span><span style="color:#ABB2BF;">)));</span></span></code></pre></div>`,16),t=[o];function p(c,r,i,B,y,d){return a(),l("div",null,t)}const A=s(e,[["render",p]]);export{F as __pageData,A as default};
