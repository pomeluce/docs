import{_ as s,o as a,c as n,V as l}from"./chunks/framework.a215caf7.js";const h=JSON.parse('{"title":"Rsnapshot 备份","description":"","frontmatter":{},"headers":[],"relativePath":"develop/linux/software/software001.md","filePath":"develop/linux/software/software001.md","lastUpdated":1700906201000}'),o={name:"develop/linux/software/software001.md"},p=l(`<h1 id="rsnapshot-备份" tabindex="-1">Rsnapshot 备份 <a class="header-anchor" href="#rsnapshot-备份" aria-label="Permalink to &quot;Rsnapshot 备份&quot;">​</a></h1><h2 id="软件安装" tabindex="-1">软件安装 <a class="header-anchor" href="#软件安装" aria-label="Permalink to &quot;软件安装&quot;">​</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># archlinux</span></span>
<span class="line"><span style="color:#61AFEF;">pacman</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-S</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">rsnapshot</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># centos</span></span>
<span class="line"><span style="color:#61AFEF;">yum</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">install</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">epel-release</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-y</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 如果之前没安装过第三方库 EPEL</span></span>
<span class="line"><span style="color:#61AFEF;">yum</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">install</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">rsnapshot</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-y</span></span></code></pre></div><h2 id="ssh免密配置" tabindex="-1">SSH免密配置 <a class="header-anchor" href="#ssh免密配置" aria-label="Permalink to &quot;SSH免密配置&quot;">​</a></h2><p>具体内容见: <a href="./../syserver/syserver001.html">ssh 免密配置</a></p><h2 id="软件配置" tabindex="-1">软件配置 <a class="header-anchor" href="#软件配置" aria-label="Permalink to &quot;软件配置&quot;">​</a></h2><ol><li>配置文件默认在 /etc/rsnapshot.conf, 在修改之前建议先进行备份, 以便于恢复</li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 备份默认配置文件</span></span>
<span class="line"><span style="color:#61AFEF;">cp</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-rp</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/etc/rsnapshot.conf</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/etc/rsnapshot.conf.bak</span></span></code></pre></div><ol start="2"><li>指定备份记得备份目录</li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">snapshot_root</span><span style="color:#ABB2BF;">   </span><span style="color:#98C379;">/data/backup/</span></span></code></pre></div><ol start="3"><li>取消注释 cmd_ssh 允许远程备份通过 ssh 进行备份</li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">cmd_ssh</span><span style="color:#ABB2BF;">         </span><span style="color:#98C379;">/usr/bin/ssh</span></span></code></pre></div><ol start="4"><li>指定备份级别</li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;">#########################################</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># BACKUP LEVELS / INTERVALS #</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Must be unique and in ascending order #</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># e.g. alpha, beta, gamma, etc. #</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#########################################</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">retain</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">hourly</span><span style="color:#ABB2BF;">  </span><span style="color:#D19A66;">24</span></span>
<span class="line"><span style="color:#61AFEF;">retain</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">daily</span><span style="color:#ABB2BF;">   </span><span style="color:#D19A66;">7</span></span>
<span class="line"><span style="color:#61AFEF;">retain</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">weekly</span><span style="color:#ABB2BF;">  </span><span style="color:#D19A66;">4</span></span>
<span class="line"><span style="color:#61AFEF;">retain</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">monthly</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">3</span></span></code></pre></div><blockquote><p>在这里, retain daily 7 意味着每次运行 rsnapshot daily 时, 都会创建一个新快照, 轮换旧快照, 并在 Rsnapshot 根目录中名为 daily.0,, daily.1, ...的目录中保留最近的 7 个备份, 然后下次运行该命令时,该 daily.6 目录将被删除</p></blockquote><ol start="6"><li>如果修改了 ssh 的默认端口, 则需要指定修改后的 ssh 端口</li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># ssh_args -p 端口号</span></span>
<span class="line"><span style="color:#61AFEF;">ssh_args</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-p</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">2222</span></span></code></pre></div><ol start="7"><li>如果要开启日志, 则取消注释 logfile 行</li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">logfile</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/var/log/rsnapshot</span></span></code></pre></div><ol start="8"><li>指定备份目录</li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;">###############################</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">### BACKUP POINTS / SCRIPTS ###</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">###############################</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># backup 要备份的目录           备份文件存储目录</span></span>
<span class="line"><span style="color:#61AFEF;">backup</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/home/example/data/</span><span style="color:#ABB2BF;">     </span><span style="color:#98C379;">local/</span><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">#备份本地目录</span></span>
<span class="line"><span style="color:#61AFEF;">backup</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">root@ip:/example/data/</span><span style="color:#ABB2BF;">   </span><span style="color:#98C379;">remote/</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;">#备份远程目录</span></span></code></pre></div><blockquote><p>Ps: 由于上面已经配置过 rsnapshot_root 目录, 所以这里不用写全路径 /data/backup/local/ 和 /data/backup/remote/</p></blockquote><p>配置完后, 保存并关闭 /etc/rsnapshot.conf 文件, 同时输入 rsnapshot configtest 命令验证配置是否成功, 如果成功, 会输出: <code>Syntax OK</code></p><h2 id="数据备份" tabindex="-1">数据备份 <a class="header-anchor" href="#数据备份" aria-label="Permalink to &quot;数据备份&quot;">​</a></h2><ol><li>手动备份, 执行一下命令, 开启备份</li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># rsnapshot 备份级别, 这里的备份级别为上面配置文件自己定义的备份级别</span></span>
<span class="line"><span style="color:#61AFEF;">rsnapshot</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">daily</span></span></code></pre></div><ol start="2"><li>计划备份, 定义 cron 作业来定期执行执行备份作业</li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 在 /etc/cron.d/ 目录中, 新建一个 rsnapshot 文件, 指定对应级别</span></span>
<span class="line"><span style="color:#61AFEF;">0</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">*</span><span style="color:#98C379;">/1</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">*</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">*</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">*</span><span style="color:#ABB2BF;">  </span><span style="color:#98C379;">/usr/bin/rsnapshot</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">hourly</span><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;"># 每小时进行一次备份, 使用 hourly 级别</span></span>
<span class="line"><span style="color:#61AFEF;">0</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">20</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">*</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">*</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">*</span><span style="color:#ABB2BF;">   </span><span style="color:#98C379;">/usr/bin/rsnapshot</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">daily</span><span style="color:#ABB2BF;">   </span><span style="color:#7F848E;font-style:italic;"># 每天晚上 8 点进行一次备份, 使用 daily 级别</span></span>
<span class="line"><span style="color:#61AFEF;">0</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">21</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">*</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">*</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">   </span><span style="color:#98C379;">/usr/bin/rsnapshot</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">weekly</span><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;"># 每天周天 21 点进行一次备份, 使用 weekly 级别</span></span>
<span class="line"><span style="color:#61AFEF;">0</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">22</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">15</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">*</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">*</span><span style="color:#ABB2BF;">  </span><span style="color:#98C379;">/usr/bin/rsnapshot</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">monthly</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 每月 15 号 22 点进行一次备份, 使用 monthly 级别</span></span></code></pre></div><h2 id="多策略备份" tabindex="-1">多策略备份 <a class="header-anchor" href="#多策略备份" aria-label="Permalink to &quot;多策略备份&quot;">​</a></h2><p>上面的备份中, 使用不同的备份级别备份的目录都是一样的, 如果想使用不同级别备份不同的目录数据, 可以配置多份配置文件, 在执行命令时指定对应的配置文件, 来实现不同策略备份不同数据</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">rsnapshot</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-c</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/path/rsnapshot1.conf</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">daily</span></span>
<span class="line"><span style="color:#61AFEF;">rsnapshot</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-c</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/path/rsnapshot2.conf</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">weekly</span></span></code></pre></div>`,31),e=[p];function t(c,r,y,i,B,F){return a(),n("div",null,e)}const A=s(o,[["render",t]]);export{h as __pageData,A as default};
